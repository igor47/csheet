[tools]
bun = "latest"
jj = "latest"
dbmate = "latest"
jq = "latest"

[env]
# Optional: Set default port
PORT = "3000"

[tasks.dev]
run = "bun run --watch main.ts"
description = "Start development server with hot reload"

[tasks.start]
run = "bun run main.tsx"
description = "Start production server"

[tasks.install]
run = "bun install"
description = "Install dependencies"

[tasks.dbmate]
run = """
  DB_PATH=$(bun src/config.ts | jq -r '.sqliteDbPath')
  echo "Using database path: $DB_PATH"
  DATABASE_URL="sqlite:$DB_PATH" DBMATE_MIGRATIONS_DIR="./migrations" dbmate "$@"
"""
description = "Run dbmate with configured database path"

[tasks.db]
run = """
  DB_PATH=$(bun src/config.ts | jq -r '.sqliteDbPath')
  sqlite3 "$DB_PATH" -init db/init.sql
"""
description = "Open SQLite shell for the database"

[tasks.check]
run = """
  echo "Running Biome checks..."
  bun biome check src/
  echo "Running TypeScript checks..."
  bun tsc --noEmit
"""
description = "Check code formatting, linting, and types"

[tasks.check-fix]
run = """
  echo "Running Biome fixes..."
  bun biome check --write src/
  echo "Running TypeScript checks..."
  bun tsc --noEmit
"""
description = "Auto-fix formatting and linting issues, then check types"
